<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>奖品编辑</title>
    <link href="http://resali.huobanplus.com/cdn/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://resali.huobanplus.com/cdn/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
    <!-- Morris -->
    <link href="http://resali.huobanplus.com/cdn/hotui/css/plugins/morris/morris-0.4.3.min.css" rel="stylesheet">
    <link href="http://resali.huobanplus.com/cdn/hotui/css/animate.min.css" rel="stylesheet">
    <link href="http://resali.huobanplus.com/cdn/hotui/css/style.min-1.0.7.css" rel="stylesheet">
    <!--checkbox-->
    <link href="http://resali.huobanplus.com/cdn/hotui/css/plugins/awesome-bootstrap-checkbox/awesome-bootstrap-checkbox.css"
          rel="stylesheet">
    <!--datetimepick-->
    <link href="http://resali.huobanplus.com/cdn/hotui/css/plugins/datetimepick/daterangepicker.css" rel="stylesheet"/>
</head>

<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeInRight tooltip-demo">
    <div class="ibox float-e-margins">
        <div class="ibox-title">
            <h5>奖品编辑信息</h5>
        </div>
        <div class="ibox-content">
            <form method="post" th:action="@{/mall/prize/save}" class="form-horizontal" id="editSavePrize">
                <input type="hidden" th:value="${actPrize.activity.actId}" name="actId">
                <input type="hidden" th:value="${actPrize.prizeCount}" name="prizeCount">
                <input type="hidden" th:if="${not #lists.isEmpty(actPrize.prizeId)}" th:value="${actPrize.prizeId}"
                       name="prizeId">
                <input type="hidden" th:if="${not #lists.isEmpty(actPrize.prizeType)}"
                       th:value="${actPrize.prizeType.code}" name="prizeType">
                <input type="hidden" th:if="${#lists.isEmpty(actPrize.prizeType)}" value="0" name="prizeType">
                <div class="form-group">
                    <label class="col-sm-3 control-label">奖品名称:</label>
                    <div class="col-sm-3">
                        <input type="text" placeholder="奖品名称" class="form-control" name="prizeName" maxlength="30"
                               th:value="${actPrize.prizeName}" required>
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">奖品类型:</label>
                    <div class="col-sm-2">
                        <span th:if="${actPrize.prizeType.code>0}" id="prizeType">奖品</span>
                        <span th:if="${actPrize.prizeType.code==0}" id="prizeType">谢谢惠顾</span>
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">上传图片</label>
                    <div class="col-sm-3">
                        <input type="hidden" name="prizeImageUrl" th:value="${actPrize.prizeImageUrl}"/>
                        <input type="file" id="uploadFile" name="btnFile" readonly="readonly" class="form-control">
                        <button class="btn btn-sm btn-success" id="uploadImage" type="button"
                                onclick="prizeEditHandler.uploadFile()">上传图片
                        </button>
                        <span class="help-block"><i class="fa fa-info-circle"></i>推荐尺寸：200*200</span>
                        <img class="imageShow" src="../../resources/images/infoBg.png"
                             th:src="${actPrize.prizeImageUrl}" style="width:200px;height:200px;"/>
                    </div>
                </div>
                <div class="hr-line-dashed"></div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">奖品数量:</label>
                    <div class="col-sm-3">
                        <input type="text" placeholder="奖品数量" class="form-control" id="remainCount" name="remainCount" required maxlength="10"
                               th:value="${actPrize.remainCount}">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">中奖概率:</label>
                    <div class="col-sm-3">
                        <input type="hidden" id="winRate" th:if="${actPrize.activity.openStatus}" placeholder="中奖概率" maxlength="10"
                               th:value="${actPrize.winRate}" name="winRate" required
                               class="form-control">
                        <span th:if="${actPrize.activity.openStatus}" th:text="${actPrize.winRate}+'%'"></span>
                        <input th:unless="${actPrize.activity.openStatus}" type="text" placeholder="中奖概率"
                               th:value="${actPrize.winRate}" name="winRate" id="winRate" required maxlength="10"
                               class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="col-sm-3 control-label">排序字段:</label>
                    <div class="col-sm-3">
                        <input type="text" placeholder="排序字段" id="sort" class="form-control" th:value="${actPrize.sort}" required maxlength="10"
                               name="sort">
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-sm-8 col-sm-offset-5">
                        <button class="btn btn-sm btn-success" type="button" onclick="prizeEditHandler.screen()">
                            保存
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<!--基础框架js-->
<script src="http://resali.huobanplus.com/cdn/jquery/3.2.1/jquery.min.js"></script>
<script src="../../resources/js/plugins/hot/bootstrap.hot.extra-utils.js"
        th:src="@{/resources/js/plugins/hot/bootstrap.hot.extra-utils.js}"></script>
<script src="http://resali.huobanplus.com/cdn/bootstrap/3.3.7/bootstrap.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/prettyfile/bootstrap-prettyfile.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/switchery/switchery.js"></script>
<script src="http://resali.huobanplus.com/cdn/layer/3.0.3/layer.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/sweetalert/sweetalert.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/jquery-validation/1.15.0/jquery.validate.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/jquery-validation/1.15.0/additional-methods.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/jquery-validation/1.15.0/localization/messages_zh.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/validate/messages_zh.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/summernote/summernote.min.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/summernote/summernote-zh-CN.js"></script>
<script src="http://resali.huobanplus.com/cdn/hotui/js/plugins/ajaxfileupload/ajaxfileupload.js"></script>

<script type="text/javascript">
    var prizeEditHandler = {
        uploadFile: function () {
            hot.loading.show();
            if($('#uploadFile').val() == undefined ||  $('#uploadFile').val().length == 0 ) {
                hot.tip.msg("图片不能为空");
            }else{
                $.ajaxFileUpload({
                    url: "/common/upload",
                    secureuri: false,// 一般设置为false
                    fileElementId: "uploadFile",// 文件上传表单的id <input type="file" id="fileUpload" name="file" />
                    dataType: 'json',// 返回值类型 一般设置为json
                    type: "post",
                    success: function (data) // 服务器成功响应处理函数
                    {
                        if (data.code == 200) {
                            $('#imageShow').attr('src', data.fileUrl);
                            $("input:hidden[name='prizeImageUrl']").val(data.fileUri);
                            hot.tip.success(data.msg);
                        } else {
                            hot.loading.hide();
                        }
                    },
                    error: function ()// 服务器响应失败处理函数
                    {
                        hot.tip.error("服务器异常,请稍后再试");
                    }
                })
            }
        },
        screen: function () {
            var type = $("#prizeType").html();
            if (type == 0) {
                $("input:hidden[name='prizeType']").val("PRIZE_TYPE_THANKS");
            } else {
                $("input:hidden[name='prizeType']").val("PRIZE_TYPE_ENTITY_PRIZE");
            }
            $("#editSavePrize").valid();
           $("#editSavePrize").submit();
        }
    }
    $(function () {
        $("#editSavePrize").validate({
            ignore: [],
            rules: {
                remainCount: {"digits": true, min: 1},
                winRate: {"digits": true, min: 1, max: 100},
                sort: {"digits": true, min: 1}
            },
            messages: {
                prizeName:"奖品名称不能为空",
                remainCount: "奖品数量大于0",
                winRate: "中奖概率大于0小于100",
                sort: "排序字段整数大于0",

            }
        });
    });
</script>
</body>

</html>
